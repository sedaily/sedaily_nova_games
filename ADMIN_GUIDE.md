# Admin 퀴즈 관리 시스템

## 🎯 주요 기능

### 1. 문제 추가 (누적 방식)
- **한 문제씩 추가**: 저장 버튼을 누르면 해당 문제만 Lambda로 전송
- **자동 병합**: Lambda가 같은 날짜의 기존 문제와 자동으로 병합
- **중복 방지**: 같은 ID가 있으면 업데이트, 없으면 추가

### 2. 자동 초기화
- 저장 성공 후 **2초 대기**
- 입력 필드 자동 초기화 (새 문제 작성 준비)
- **테마 유지**: 마지막 선택한 게임 테마 그대로 유지
- **비밀번호 유지**: 세션에 저장되어 새로고침 불필요

### 3. 지원 문제 유형
- **객관식**: 선택지 2~6개, 정답 번호 ("1", "2", "3"...)
- **주관식**: 정답 텍스트 입력

## 📋 사용 방법

### 1. 환경 설정

`.env.local` 파일에 Lambda API Gateway URL 설정:

```env
NEXT_PUBLIC_QUIZ_SAVE_URL=https://your-api-id.execute-api.us-east-1.amazonaws.com/prod/quizzes
```

### 2. 개발 서버 실행

```bash
pnpm run dev
```

### 3. 문제 작성 흐름

1. `/admin/quiz` 접속
2. 비밀번호 입력 (최초 1회)
3. 날짜 선택 (캘린더)
4. 문제 작성:
   - 게임 테마 선택 (BlackSwan / PrisonersDilemma / SignalDecoding)
   - 문제 유형 선택 (객관식 / 주관식)
   - 질문 내용 입력
   - 선택지 입력 (객관식) 또는 정답 입력 (주관식)
   - 해설, 관련 기사, 태그 입력
5. **저장** 버튼 클릭
6. ✅ "문제가 성공적으로 추가되었습니다!" 메시지 확인
7. 2초 후 자동 초기화 → 다음 문제 작성 가능

### 4. 여러 문제 연속 작성

**예시: 같은 날짜에 4개 문제 추가**

```
13:00 - 문제 1 작성 → 저장 → 초기화
13:05 - 문제 2 작성 → 저장 → 초기화
13:10 - 문제 3 작성 → 저장 → 초기화
13:15 - 문제 4 작성 → 저장 → 완료

결과: 해당 날짜에 4문제 누적 저장됨
```

## 🔄 Lambda 병합 로직

### 작동 방식

1. **프론트엔드**: 새 문제 1개만 전송
   ```json
   {
     "gameType": "BlackSwan",
     "quizDate": "2025-10-16",
     "data": {
       "questions": [{ "id": "20251016-BS-001", ... }]
     }
   }
   ```

2. **Lambda**: 
   - DynamoDB에서 기존 데이터 조회
   - 기존 questions 배열과 새 questions 병합
   - ID 기준으로 중복 제거/업데이트
   - 병합된 전체 배열 저장

3. **결과**:
   ```json
   {
     "gameType": "BlackSwan",
     "quizDate": "2025-10-16",
     "data": {
       "questions": [
         { "id": "20251016-BS-001", ... },  // 13시에 추가
         { "id": "20251016-BS-002", ... },  // 15시에 추가
         { "id": "20251016-BS-003", ... }   // 17시에 추가
       ]
     }
   }
   ```

## 📝 필수 입력 필드

### 공통
- ✅ 게임 테마
- ✅ 문제 유형 (객관식/주관식)
- ✅ 질문 내용
- ✅ 해설
- ✅ 태그
- ✅ 제작자 이름

### 객관식
- ✅ 선택지 2~6개 (빈 항목 없어야 함)
- ✅ 정답 선택

### 주관식
- ✅ 정답 텍스트

## 🎨 UI/UX

### 저장 상태 표시
- **저장 중**: "저장 중..." (버튼 비활성화)
- **저장 성공**: ✓ "문제가 성공적으로 추가되었습니다!" (녹색)
- **저장 실패**: 에러 메시지 표시 (빨간색)

### 자동화
- 저장 성공 시 2초 후 자동 초기화
- 날짜/테마는 그대로 유지
- 비밀번호 재입력 불필요 (세션 저장)

## 🔧 기술 스택

- **Frontend**: Next.js 15 + React 19 + TypeScript
- **Backend**: AWS Lambda (Node.js)
- **Database**: DynamoDB
- **API**: API Gateway (REST API)
- **Validation**: Zod (선택적)

## 📦 데이터 변환

### Admin UI → Lambda 형식

```typescript
// Admin UI 형식
{
  id: "q-1234567890",
  theme: "BlackSwan",
  questionType: "객관식",
  question_text: "질문?",
  choices: ["보기1", "보기2", "보기3"],
  correct_index: 1,  // 0부터 시작
  explanation: "해설",
  tags: "경제·금융",
  related_article: { url: "https://..." }
}

// Lambda 형식으로 변환
{
  id: "20251016-BS-001",
  questionType: "객관식",
  question: "질문?",
  options: ["보기1", "보기2", "보기3"],
  answer: "2",  // 1부터 시작하는 문자열
  explanation: "해설",
  newsLink: "https://...",
  tags: "경제·금융"
}
```

## 🚨 에러 처리

### 유효성 검사 실패
- 빨간색 에러 박스로 누락 필드 표시
- 저장 버튼 비활성화되지 않음 (재시도 가능)

### Lambda 저장 실패
- 에러 메시지 표시
- 입력 내용 유지 (초기화되지 않음)
- 재저장 가능

## 💡 팁

1. **연속 작성**: 같은 테마의 문제를 여러 개 작성할 때는 테마가 자동 유지됨
2. **ID 자동 생성**: `yyyyMMdd-BS-timestamp` 형식으로 자동 생성
3. **태그 일관성**: 태그는 API 응답과 동일한 형식 사용 ("경제·금융", "산업", "부동산" 등)
4. **관련 기사**: URL만 필수, title/snippet은 선택적
